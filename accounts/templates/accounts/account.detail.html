<!-- ê³„ì¢Œ ìƒì„¸ + ê±°ë˜ ë‚´ì—­ -->
<!-- accounts/templates/accounts/account_detail.html -->
{% extends 'base.html' %}
{% load static %}

{% block title %}{{ account.name }} - AccountBook{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/account.css' %}">
<link rel="stylesheet" href="{% static 'css/transactions.css' %}">
{% endblock %}

{% block content %}
<div class="account-detail-container">
    <!-- ìƒë‹¨ í—¤ë” -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>{{ account.name }}</h2>
        <div class="d-flex gap-2">
            <a href="{% url 'accounts:account_update' account.pk %}" class="btn btn-primary">ìˆ˜ì •</a>
            <a href="{% url 'accounts:account_list' %}" class="btn btn-secondary">ëª©ë¡</a>
        </div>
    </div>
    
    <!-- ê³„ì¢Œ ì •ë³´ ì¹´ë“œ -->
    <div class="account-detail-card mb-4">
        <div class="account-detail-header">
            <h5 class="card-title">ê³„ì¢Œ ì •ë³´</h5>
        </div>
        
        <table class="account-detail-table">
            <tr>
                <th>ê³„ì¢Œëª…</th>
                <td>{{ account.name }}</td>
            </tr>
            <tr>
                <th>ì€í–‰</th>
                <td>{{ account.bank_name }}</td>
            </tr>
            <tr>
                <th>ê³„ì¢Œë²ˆí˜¸</th>
                <td class="account-number">{{ account.masked_account_number }}</td>
            </tr>
            <tr>
                <th>í˜„ì¬ ì”ì•¡</th>
                <td>
                    <strong class="text-primary" style="font-size: 1.3rem;">
                        {{ account.balance|floatformat:0 }}ì›
                    </strong>
                </td>
            </tr>
            <tr>
                <th>ìƒíƒœ</th>
                <td>
                    {% if account.is_active %}
                        <span class="account-status account-status-active">í™œì„±</span>
                    {% else %}
                        <span class="account-status account-status-inactive">ë¹„í™œì„±</span>
                    {% endif %}
                </td>
            </tr>
            <tr>
                <th>ìƒì„±ì¼</th>
                <td>{{ account.created_at|date:"Yë…„ mì›” dì¼ H:i" }}</td>
            </tr>
            <tr>
                <th>ìµœì¢… ìˆ˜ì •ì¼</th>
                <td>{{ account.updated_at|date:"Yë…„ mì›” dì¼ H:i" }}</td>
            </tr>
        </table>
        
        <!-- ì‚­ì œ ë²„íŠ¼ -->
        <div class="mt-4">
            <form method="post" action="{% url 'accounts:account_delete' account.pk %}" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger" onclick="return confirm('ì •ë§ ì´ ê³„ì¢Œë¥¼ ë¹„í™œì„±í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì—°ê²°ëœ ê±°ë˜ ë‚´ì—­ì€ ìœ ì§€ë©ë‹ˆë‹¤.')">
                    ê³„ì¢Œ ë¹„í™œì„±í™”
                </button>
            </form>
        </div>
    </div>
    
    <!-- ê±°ë˜ ë‚´ì—­ ì„¹ì…˜ -->
    <div class="card">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="card-title mb-0">ì´ ê³„ì¢Œì˜ ê±°ë˜ ë‚´ì—­</h5>
                <a href="{% url 'transactions:transaction_create' %}?account={{ account.pk }}" class="btn btn-primary btn-sm">
                    + ê±°ë˜ ì¶”ê°€
                </a>
            </div>
            
            <!-- ê±°ë˜ ë‚´ì—­ í…Œì´ë¸” -->
            {% if transactions %}
                <div class="table-responsive">
                    <table class="transaction-table">
                        <thead>
                            <tr>
                                <th>ë‚ ì§œ</th>
                                <th>íƒ€ì…</th>
                                <th>ì¹´í…Œê³ ë¦¬</th>
                                <th>ê¸ˆì•¡</th>
                                <th>ê°€ë§¹ì </th>
                                <th>ë©”ëª¨</th>
                                <th>ì‘ì—…</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for transaction in transactions %}
                            <tr>
                                <td data-label="ë‚ ì§œ">
                                    {{ transaction.occurred_at|date:"Y-m-d" }}
                                </td>
                                <td data-label="íƒ€ì…">
                                    {% if transaction.tx_type == 'IN' %}
                                        <span class="transaction-type transaction-type-in">ì…ê¸ˆ</span>
                                    {% else %}
                                        <span class="transaction-type transaction-type-out">ì¶œê¸ˆ</span>
                                    {% endif %}
                                </td>
                                <td data-label="ì¹´í…Œê³ ë¦¬">
                                    {{ transaction.category.name|default:"-" }}
                                </td>
                                <td data-label="ê¸ˆì•¡">
                                    <span class="transaction-amount {% if transaction.tx_type == 'IN' %}transaction-amount-in{% else %}transaction-amount-out{% endif %}">
                                        {{ transaction.amount|floatformat:0 }}ì›
                                    </span>
                                </td>
                                <td data-label="ê°€ë§¹ì ">
                                    {{ transaction.merchant|default:"-"|truncatechars:20 }}
                                </td>
                                <td data-label="ë©”ëª¨">
                                    {{ transaction.memo|default:"-"|truncatechars:30 }}
                                </td>
                                <td data-label="ì‘ì—…">
                                    <a href="{% url 'transactions:transaction_detail' transaction.pk %}" class="btn btn-sm btn-outline-primary">
                                        ìƒì„¸
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                <!-- ê±°ë˜ ìš”ì•½ -->
                <div class="mt-4">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="stat-info-card">
                                <div class="stat-info-title">ì´ ê±°ë˜ ê±´ìˆ˜</div>
                                <div class="stat-info-value">{{ transactions|length }}ê±´</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="stat-info-card" style="border-left-color: #28a745;">
                                <div class="stat-info-title">ì´ ì…ê¸ˆ</div>
                                <div class="stat-info-value text-success">
                                    {% widthratio total_income 1 1 %}ì›
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="stat-info-card" style="border-left-color: #dc3545;">
                                <div class="stat-info-title">ì´ ì¶œê¸ˆ</div>
                                <div class="stat-info-value text-danger">
                                    {% widthratio total_expense 1 1 %}ì›
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- í˜ì´ì§€ë„¤ì´ì…˜ (ì„ íƒì‚¬í•­) -->
                {% if is_paginated %}
                <nav aria-label="Page navigation" class="mt-4">
                    <ul class="pagination justify-content-center">
                        {% if page_obj.has_previous %}
                            <li class="page-item">
                                <a class="page-link" href="?page=1">ì²˜ìŒ</a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.previous_page_number }}">ì´ì „</a>
                            </li>
                        {% endif %}
                        
                        <li class="page-item active">
                            <span class="page-link">
                                {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}
                            </span>
                        </li>
                        
                        {% if page_obj.has_next %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.next_page_number }}">ë‹¤ìŒ</a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">ë§ˆì§€ë§‰</a>
                            </li>
                        {% endif %}
                    </ul>
                </nav>
                {% endif %}
                
            {% else %}
                <!-- ê±°ë˜ ë‚´ì—­ ì—†ìŒ -->
                <div class="transaction-empty">
                    <div class="transaction-empty-icon">ğŸ“</div>
                    <h5 class="transaction-empty-title">ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</h5>
                    <p class="transaction-empty-text">ì´ ê³„ì¢Œì˜ ì²« ê±°ë˜ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>
                    <a href="{% url 'transactions:transaction_create' %}?account={{ account.pk }}" class="btn btn-primary">
                        + ì²« ê±°ë˜ ì¶”ê°€í•˜ê¸°
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}