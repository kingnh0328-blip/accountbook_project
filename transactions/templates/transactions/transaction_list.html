<!-- transactions/templates/transactions/transaction_list.html -->
{% extends 'base.html' %}

{% block title %}거래 내역 - AccountBook{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>거래 내역</h2>
   <li class="nav-item d-flex align-items-center gap-2" style="list-style: none;">
    <a href="{% url 'transactions:transaction_create' %}?type=IN" class="btn btn-sm btn-success">
        + 수입
    </a>
    <a href="{% url 'transactions:transaction_create' %}?type=OUT" class="btn btn-sm btn-danger">
        + 지출
    </a>
</li>
</div>

<!-- 필터링 폼 -->
<div class="card mb-4">
    <div class="card-body">
        <form method="get" class="row g-3">
            <div class="col-md-3">
                <input type="date" name="start_date" class="form-control" placeholder="시작일" value="{{ request.GET.start_date }}">
            </div>
            <div class="col-md-3">
                <input type="date" name="end_date" class="form-control" placeholder="종료일" value="{{ request.GET.end_date }}">
            </div>
            <div class="col-md-2">
                <select name="tx_type" class="form-control">
                    <option value="">전체</option>
                    <option value="IN" {% if request.GET.tx_type == 'IN' %}selected{% endif %}>입금</option>
                    <option value="OUT" {% if request.GET.tx_type == 'OUT' %}selected{% endif %}>출금</option>
                </select>
            </div>
            <div class="col-md-3">
                <input type="text" name="q" class="form-control" placeholder="검색" value="{{ request.GET.q }}">
            </div>
            <div class="col-md-1">
                <button type="submit" class="btn btn-secondary w-100">검색</button>
            </div>
        </form>
    </div>
</div>

<!-- 거래 목록 -->
{% if transactions %}
    <div class="table-responsive">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>날짜</th>
                    <th>타입</th>
                    <th>계좌</th>
                    <th>카테고리</th>
                    <th>금액</th>
                    <th>가맹점</th>
                    <th>메모</th>
                    <th>영수증</th>
                    <th>작업</th>
                </tr>
            </thead>
            <tbody>
                {% for transaction in transactions %}
                <tr>
                    <td>{{ transaction.occurred_at|date:"Y-m-d" }}</td>
                    <td>
                        {% if transaction.tx_type == 'IN' %}
                            <span class="badge bg-success">입금</span>
                        {% else %}
                            <span class="badge bg-danger">출금</span>
                        {% endif %}
                    </td>
                    <td>{{ transaction.account.name }}</td>
                    <td>{{ transaction.category.name|default:"-" }}</td>
                    <td>{{ transaction.amount|floatformat:0 }}원</td>
                    <td>{{ transaction.merchant|default:"-" }}</td>
                    <td>{{ transaction.memo|truncatewords:5 }}</td>
                    <td>
                        {% if transaction.attachment %}
                            ✓
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>
                        <a href="{% url 'transactions:transaction_detail' transaction.pk %}" class="btn btn-sm btn-outline-primary">상세</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% else %}
    <div class="alert alert-info">
        거래 내역이 없습니다. 첫 거래를 추가해보세요!
    </div>
{% endif %}
{% endblock %}