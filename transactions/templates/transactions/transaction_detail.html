<!-- transactions/templates/transactions/transaction_detail.html -->
{% extends 'base.html' %}

{% block title %}거래 상세 - AccountBook{% endblock %}

{% block content %}
<h2>거래 상세</h2>

<div class="card mt-4">
    <div class="card-body">
        <table class="table">
            <tr>
                <th width="30%">거래 타입</th>
                <td>
                    {% if transaction.tx_type == 'IN' %}
                        <span class="badge bg-success">입금</span>
                    {% else %}
                        <span class="badge bg-danger">출금</span>
                    {% endif %}
                </td>
            </tr>
            <tr>
                <th>계좌</th>
                <td>{{ transaction.account.name }} ({{ transaction.account.bank_name }})</td>
            </tr>
            <tr>
                <th>금액</th>
                <td><strong>{{ transaction.amount|floatformat:0 }}원</strong></td>
            </tr>
            <tr>
                <th>거래일시</th>
                <td>{{ transaction.occurred_at }}</td>
            </tr>
            <tr>
                <th>카테고리</th>
                <td>{{ transaction.category.name|default:"-" }}</td>
            </tr>
            <tr>
                <th>가맹점/거래처</th>
                <td>{{ transaction.merchant|default:"-" }}</td>
            </tr>
            <tr>
                <th>메모</th>
                <td>{{ transaction.memo|default:"-" }}</td>
            </tr>
        </table>
        
        <!-- 영수증 섹션 -->
        <h5 class="mt-4">영수증</h5>
        {% if transaction.attachment %}
            <div class="mb-3">
                {% if transaction.attachment.content_type == 'application/pdf' %}
                    <a href="{{ transaction.attachment.file.url }}" target="_blank" class="btn btn-outline-primary">PDF 보기</a>
                {% else %}
                    <img src="{{ transaction.attachment.file.url }}" alt="영수증" class="img-fluid" style="max-width: 500px;">
                {% endif %}
                <form method="post" action="{% url 'transactions:attachment_delete' transaction.attachment.pk %}" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('영수증을 삭제하시겠습니까?')">삭제</button>
                </form>
            </div>
        {% else %}
            <p class="text-muted">첨부된 영수증이 없습니다.</p>
            <a href="{% url 'transactions:attachment_upload' transaction.pk %}" class="btn btn-outline-primary">영수증 업로드</a>
        {% endif %}
        
        <hr class="my-4">
        
        <div class="d-flex gap-2">
            <a href="{% url 'transactions:transaction_update' transaction.pk %}" class="btn btn-primary">수정</a>
            <a href="{% url 'transactions:transaction_list' %}" class="btn btn-secondary">목록</a>
            <form method="post" action="{% url 'transactions:transaction_delete' transaction.pk %}" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger" onclick="return confirm('정말 삭제하시겠습니까?')">삭제</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}